<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Treasure Hunt</title>
<style>
  :root{
    --cold-grad: linear-gradient(135deg,#063d4a,#046b77);
    --warm-grad: linear-gradient(135deg,#ff9f43,#ff6b6b);
    --hot-grad:  linear-gradient(135deg,#ff3b3b,#ff0066);
    --found-grad: linear-gradient(135deg,#76ff03,#b2ff59);
    --card-bg: rgba(255,255,255,0.02);
    --muted: rgba(255,255,255,0.8);
  }
  html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--cold-grad);color:#fff}
  .wrap{max-width:520px;margin:28px auto;padding:14px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));padding:14px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.35)}
  h1{margin:0 0 6px 0;color:#fff;font-size:1.05rem}
  p.lead{margin:0 0 12px 0;color:rgba(255,255,255,0.85);font-size:0.92rem}
  .status{display:flex;align-items:center;gap:10px;margin:8px 0}
  .badge{width:56px;height:56px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px}
  .cold{background:rgba(255,255,255,0.04);box-shadow:0 6px 18px rgba(0,0,0,0.25)}
  .warm{background:rgba(255,255,255,0.06)}
  .hot{background:rgba(255,255,255,0.06)}
  .found{background:rgba(255,255,255,0.06);color:#06220a}
  .status-text{flex:1}
  .title{margin:0;font-weight:700}
  .sub{margin:4px 0 0 0;color:rgba(255,255,255,0.85);font-size:0.88rem}
  .controls{display:flex;gap:8px;margin-top:12px}
  button{padding:10px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:700}
  .primary{background:#ffd166;color:#06220a}
  .ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:rgba(255,255,255,0.95)}
  #code-section{display:none;margin-top:12px}
  input[type="text"]{width:100%;padding:10px;border-radius:8px;border:0;margin-top:8px;background:rgba(255,255,255,0.03);color:#fff;box-sizing:border-box}
  .row{display:flex;gap:8px;margin-top:8px}
  .small{margin-top:10px;color:rgba(255,255,255,0.85);font-size:0.9rem}
  #clue-text{margin-top:10px;color:#d4ffd6;font-weight:700;min-height:22px}
  .progress{margin-top:10px;color:rgba(255,255,255,0.78);text-align:right;font-size:0.9rem}
  @media (max-width:420px){ .badge{width:48px;height:48px;font-size:16px} button{padding:10px} }
</style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Treasure Hunt</h1>

      <div class="status">
        <div id="badge" class="badge cold">‚ùÑÔ∏è</div>
        <div class="status-text">
          <div class="title" id="statusTitle">Cold</div>
          <div class="sub" id="statusSub">Press Start to begin tracking.</div>
        </div>
      </div>

      <div class="controls">
        <button id="startBtn" class="primary">Start</button>
        <button id="stopBtn" class="ghost" style="display:none">Stop</button>
        <button id="resetBtn" class="ghost">Reset</button>
      </div>

      <div id="code-section">
        <div class="small">Enter the code printed on the paper when you reach the spot.</div>
        <input id="code-input" type="text" placeholder="Paper code" inputmode="numeric" autocomplete="off"/>
        <div class="row">
          <button id="code-button" class="primary">Unlock</button>
          <button id="helpBtn" class="ghost">Help</button>
        </div>
        <div id="code-status" class="small" style="margin-top:8px;color:#ffdede"></div>
        <div id="clue-text"></div>
      </div>

      <div class="progress" id="progress">Clue 0 of 10</div>
    </div>
  </div>

<script>
/* ======= CONFIG (edit your coordinates & codes) ======= */
const clues = [
  { lat: 1.3489, lon: 103.9267, code: "111" },
  { lat: 1.3495, lon: 103.9275, code: "222" },
  { lat: 1.3502, lon: 103.9282, code: "333" },
  { lat: 1.3510, lon: 103.9290, code: "444" },
  { lat: 1.3515, lon: 103.9295, code: "555" },
  { lat: 1.3520, lon: 103.9300, code: "666" },
  { lat: 1.3525, lon: 103.9305, code: "777" },
  { lat: 1.3530, lon: 103.9310, code: "888" },
  { lat: 1.3535, lon: 103.9315, code: "999" },
  { lat: 1.3540, lon: 103.9320, code: "000" }
];

let currentIndex = 0;
let watchID = null;

/* UI refs */
const badge = document.getElementById('badge');
const statusTitle = document.getElementById('statusTitle');
const statusSub = document.getElementById('statusSub');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const resetBtn = document.getElementById('resetBtn');
const codeSection = document.getElementById('code-section');
const codeInput = document.getElementById('code-input');
const codeButton = document.getElementById('code-button');
const codeStatus = document.getElementById('code-status');
const clueText = document.getElementById('clue-text');
const progressEl = document.getElementById('progress');
const helpBtn = document.getElementById('helpBtn');

/* Haversine distance (meters) */
function getDistance(lat1, lon1, lat2, lon2){
  const R = 6371e3;
  const toRad = d => d * Math.PI/180;
  const œÜ1 = toRad(lat1), œÜ2 = toRad(lat2);
  const ŒîœÜ = toRad(lat2-lat1), ŒîŒª = toRad(lon2-lon1);
  const a = Math.sin(ŒîœÜ/2)**2 + Math.cos(œÜ1)*Math.cos(œÜ2)*Math.sin(ŒîŒª/2)**2;
  const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

/* set UI and gradient depending on proximity state */
function setProximity(state){
  if(state === 'cold'){
    document.body.style.background = getComputedStyle(document.documentElement).getPropertyValue('--cold-grad');
    badge.className = 'badge cold';
    badge.textContent = '‚ùÑÔ∏è';
    statusTitle.textContent = 'Cold';
    statusSub.textContent = 'Move around to get closer.';
    hideCode();
  } else if(state === 'warm'){
    document.body.style.background = getComputedStyle(document.documentElement).getPropertyValue('--warm-grad');
    badge.className = 'badge warm';
    badge.textContent = 'üå§Ô∏è';
    statusTitle.textContent = 'Warm';
    statusSub.textContent = 'You are getting closer!';
    hideCode();
  } else if(state === 'hot'){
    document.body.style.background = getComputedStyle(document.documentElement).getPropertyValue('--hot-grad');
    badge.className = 'badge hot';
    badge.textContent = 'üî•';
    statusTitle.textContent = 'Hot';
    statusSub.textContent = 'Very near ‚Äî search the area.';
    hideCode();
  }
}

function showCode(){ codeSection.style.display = 'block'; }
function hideCode(){ codeSection.style.display = 'none'; }

/* update progress text */
function updateProgress(){ progressEl.textContent = `Clue ${Math.min(currentIndex+1, clues.length)} of ${clues.length}`; }

/* start tracking GPS */
function startTracking(){
  if(!navigator.geolocation){ alert('Geolocation not supported'); return; }
  if(watchID !== null) return;
  // start watchPosition
  watchID = navigator.geolocation.watchPosition(pos => {
    handlePos(pos.coords.latitude, pos.coords.longitude);
  }, err => {
    statusSub.textContent = 'Enable location and allow permission.';
  }, { enableHighAccuracy: true, maximumAge: 1000, timeout: 8000 });

  startBtn.style.display = 'none';
  stopBtn.style.display = 'inline-block';
  statusSub.textContent = 'Tracking location‚Ä¶';
  updateProgress();
}

/* stop tracking */
function stopTracking(){
  if(watchID !== null){ navigator.geolocation.clearWatch(watchID); watchID = null; }
  startBtn.style.display = 'inline-block';
  stopBtn.style.display = 'none';
  statusSub.textContent = 'Tracking stopped.';
  hideCode();
}

/* reset game */
function resetGame(){
  if(!confirm('Reset progress?')) return;
  stopTracking();
  currentIndex = 0;
  updateProgress();
  clueText.textContent = '';
  codeInput.value = '';
  setProximity('cold');
}

/* handle GPS position update */
function handlePos(userLat, userLon){
  if(currentIndex >= clues.length) return;
  const target = clues[currentIndex];
  const dist = getDistance(userLat, userLon, target.lat, target.lon);

  // thresholds: adjust if needed
  if(dist < 10) setProximity('hot');
  else if(dist < 15) setProximity('warm');
  else setProximity('cold');
  // no numeric distance shown
}

/* code unlock handler */
codeButton.addEventListener('click', ()=>{
  const entered = (codeInput.value || '').trim();
  if(!entered){ codeStatus.textContent = 'Enter the code on the paper.'; return; }
  const target = clues[currentIndex];
  if(entered === target.code){
    // correct: advance but do not reveal the next clue text (paper clues remain physical)
    codeStatus.style.color = '#bfffb7';
    codeStatus.textContent = '‚úÖ Code accepted ‚Äî go find the next paper clue.';
    clueText.textContent = ''; // keep clues hidden
    currentIndex++;
    codeInput.value = '';
    updateProgress();
    // if finished:
    if(currentIndex >= clues.length){
      codeStatus.textContent = 'üèÜ Completed! Well done!';
      stopTracking();
      setTimeout(()=>{ alert('üèÜ Treasure hunt complete ‚Äî congratulations!'); }, 200);
      hideCode();
      return;
    }
    // show short confirmation then hide input until they get near next spot
    setTimeout(()=>{ codeStatus.textContent = ''; hideCode(); }, 1800);
  } else {
    codeStatus.style.color = '#ffdede';
    codeStatus.textContent = '‚ùå Incorrect code ‚Äî try again.';
  }
});

/* start/stop/reset events */
startBtn.addEventListener('click', ()=>{ startTracking(); });
stopBtn.addEventListener('click', ()=>{ stopTracking(); });
resetBtn.addEventListener('click', ()=>{ resetGame(); });

helpBtn.addEventListener('click', ()=>{
  alert('Find the paper clue in real life. When your phone says "At location", enter the code printed on that paper here to progress.');
});

/* initialize */
setProximity('cold');
updateProgress();

</script>
</body>
</html>
