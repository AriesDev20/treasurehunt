<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Arrow Pointer → Point to Lat/Lon</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#0b1220; --card:#0f1724; --accent:#06b6d4; --accent2:#7c3aed; --muted:rgba(255,255,255,0.6)}
    *{box-sizing:border-box}
    body{margin:0;min-height:100vh;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071029 0%,#07121a 100%);color:#fff;display:flex;align-items:center;justify-content:center;padding:28px}
    .wrap{width:100%;max-width:760px}
    .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.04);padding:18px;border-radius:12px;box-shadow:0 8px 30px rgba(0,0,0,0.6)}
    h1{margin:0 0 8px 0;font-size:18px}
    .subtitle{color:var(--muted);font-size:13px;margin-bottom:14px}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:14px}
    input[type=number]{padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(255,255,255,0.02);color:#fff;min-width:140px}
    button{padding:10px 12px;border-radius:8px;border:none;cursor:pointer;font-weight:600}
    .btn-primary{background:linear-gradient(90deg,var(--accent2),var(--accent));color:#fff;box-shadow:0 6px 18px rgba(124,58,237,0.12)}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.04);color:#fff}
    .row{display:flex;gap:12px;align-items:center}
    .visual{display:flex;align-items:center;gap:22px}
    .arrow-box{width:300px;height:300px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,0.01),rgba(255,255,255,0.00));border:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center}
    .arrow-svg{width:160px;height:220px}
    .needle{transform-origin:80px 100px;transition:transform 300ms cubic-bezier(.2,.9,.2,1)}
    .stats{display:flex;flex-direction:column;gap:10px}
    .stat{background:rgba(255,255,255,0.02);padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);min-width:160px}
    .muted{color:var(--muted);font-size:13px}
    @media(max-width:640px){.visual{flex-direction:column}.arrow-box{width:260px;height:260px}.arrow-svg{width:140px;height:200px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Arrow Pointer</h1>
      <div class="subtitle">Enter a target latitude & longitude — the arrow will point toward it. Simple, clean, and mobile-friendly.</div>

      <div class="controls">
        <input id="targetLat" type="number" step="any" placeholder="Latitude (e.g. 1.3521)">
        <input id="targetLon" type="number" step="any" placeholder="Longitude (e.g. 103.8198)">
        <button id="setTarget" class="btn-primary">Point</button>
        <button id="startTrack" class="btn-ghost">Start tracking</button>
        <label style="display:flex;align-items:center;color:var(--muted);gap:6px;margin-left:auto"><input id="follow" type="checkbox"> Follow</label>
      </div>

      <div class="visual">
        <div class="arrow-box">
          <!-- Simple arrow SVG: elegant head + tapered tail -->
          <svg class="arrow-svg" viewBox="0 0 160 220" xmlns="http://www.w3.org/2000/svg" aria-hidden="false">
            <defs>
              <linearGradient id="g1" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0%" stop-color="#ff6b6b" />
                <stop offset="100%" stop-color="#ffd166" />
              </linearGradient>
              <linearGradient id="g2" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0%" stop-color="#60a5fa" />
                <stop offset="100%" stop-color="#7c3aed" />
              </linearGradient>
              <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                <feDropShadow dx="0" dy="8" stdDeviation="16" flood-color="#000" flood-opacity="0.4"/>
              </filter>
            </defs>

            <!-- Tail (cool gradient) -->
            <g id="tail" transform="translate(0,0)">
              <path d="M80 200 C74 170 74 120 80 100" fill="url(#g2)" opacity="0.95" stroke="rgba(255,255,255,0.03)" stroke-width="1"/>
            </g>

            <!-- Arrow group that will be rotated -->
            <g id="arrowGroup" class="needle" transform="translate(0,0) rotate(0 80 100)">
              <!-- subtle glow behind head -->
              <ellipse cx="80" cy="60" rx="48" ry="24" fill="rgba(255,200,120,0.08)"/>
              <!-- Head -->
              <path d="M80 12 L120 76 L80 66 L40 76 Z" fill="url(#g1)" filter="url(#shadow)"/>
              <!-- Shaft -->
              <rect x="74" y="66" width="12" height="120" rx="6" ry="6" fill="rgba(255,255,255,0.06)"/>
              <!-- Accent along shaft -->
              <rect x="82" y="70" width="3" height="110" rx="2" ry="2" fill="rgba(255,255,255,0.12)" opacity="0.9"/>
            </g>

            <!-- center dot -->
            <circle cx="80" cy="100" r="6" fill="#fff" />
          </svg>
        </div>

        <div class="stats">
          <div class="stat"><div class="muted">Bearing</div><strong id="bearingVal">—°</strong></div>
          <div class="stat"><div class="muted">Heading</div><strong id="headingVal">—°</strong></div>
          <div class="stat"><div class="muted">Distance</div><strong id="distanceVal">—</strong></div>
        </div>
      </div>

    </div>
  </div>

<script>
const toRad = d => d * Math.PI / 180;
const toDeg = r => r * 180 / Math.PI;

function computeBearing(lat1, lon1, lat2, lon2){
  const φ1 = toRad(lat1), φ2 = toRad(lat2);
  const Δλ = toRad(lon2 - lon1);
  const y = Math.sin(Δλ) * Math.cos(φ2);
  const x = Math.cos(φ1)*Math.sin(φ2) - Math.sin(φ1)*Math.cos(φ2)*Math.cos(Δλ);
  let θ = Math.atan2(y,x);
  θ = (toDeg(θ) + 360) % 360;
  return θ;
}
function haversineDistance(lat1, lon1, lat2, lon2){
  const R = 6371e3;
  const φ1 = toRad(lat1), φ2 = toRad(lat2);
  const Δφ = toRad(lat2 - lat1), Δλ = toRad(lon2 - lon1);
  const a = Math.sin(Δφ/2)**2 + Math.cos(φ1)*Math.cos(φ2)*Math.sin(Δλ/2)**2;
  const c = 2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

const arrowGroup = document.getElementById('arrowGroup');
const bearingEl = document.getElementById('bearingVal');
const headingEl = document.getElementById('headingVal');
const distanceEl = document.getElementById('distanceVal');
const setTargetBtn = document.getElementById('setTarget');
const targetLatInput = document.getElementById('targetLat');
const targetLonInput = document.getElementById('targetLon');
const followCheckbox = document.getElementById('follow');
const startTrackBtn = document.getElementById('startTrack');

let currentPos = null; let targetPos = null; let watchId = null; let latestHeading = null; let haveHeading = false;

function rotateArrowTo(deg){
  // rotate around center (80,100)
  arrowGroup.setAttribute('transform', `translate(0,0) rotate(${deg} 80 100)`);
}

function updateUI(){
  if(!currentPos || !targetPos) return;
  const bearing = computeBearing(currentPos.latitude, currentPos.longitude, targetPos.lat, targetPos.lon);
  const dist = haversineDistance(currentPos.latitude, currentPos.longitude, targetPos.lat, targetPos.lon);
  bearingEl.textContent = bearing.toFixed(1) + '°';
  distanceEl.textContent = dist >= 1000 ? (dist/1000).toFixed(2) + ' km' : Math.round(dist) + ' m';

  if(haveHeading && latestHeading != null){
    const rotateDeg = (bearing - latestHeading + 360) % 360;
    rotateArrowTo(rotateDeg);
    headingEl.textContent = latestHeading.toFixed(1) + '°';
  } else {
    rotateArrowTo(bearing);
    headingEl.textContent = 'N/A';
  }
}

setTargetBtn.addEventListener('click', ()=>{
  const lat = parseFloat(targetLatInput.value); const lon = parseFloat(targetLonInput.value);
  if(!isFinite(lat) || !isFinite(lon)){ alert('Enter valid coordinates'); return; }
  targetPos = {lat, lon};
  if(!currentPos && navigator.geolocation){ navigator.geolocation.getCurrentPosition(p=>{ currentPos = p.coords; updateUI(); }, e=>{ console.warn(e); }, {enableHighAccuracy:true,timeout:10000}); }
  else updateUI();
});

startTrackBtn.addEventListener('click', ()=>{
  if(watchId!=null){ navigator.geolocation.clearWatch(watchId); watchId=null; startTrackBtn.textContent='Start tracking'; return; }
  if(!navigator.geolocation){ alert('Geolocation unavailable'); return; }
  watchId = navigator.geolocation.watchPosition(pos=>{ currentPos = pos.coords; if(followCheckbox.checked && targetPos) updateUI(); }, err=>{ alert('Error: '+err.message); }, {enableHighAccuracy:true,maximumAge:2000,timeout:10000});
  startTrackBtn.textContent='Stop tracking';
});

// device orientation (heading)
function onDeviceOrientation(e){
  let heading = null;
  if(typeof e.webkitCompassHeading === 'number') heading = e.webkitCompassHeading;
  else if(typeof e.alpha === 'number') heading = (360 - e.alpha) % 360;
  if(heading != null){ latestHeading = heading; haveHeading = true; if(targetPos && currentPos) updateUI(); }
}
window.addEventListener('deviceorientation', onDeviceOrientation);

// allow Enter key to set
[targetLatInput, targetLonInput].forEach(inp=> inp.addEventListener('keydown', e=>{ if(e.key==='Enter') setTargetBtn.click(); }));

// initial small animation
rotateArrowTo(0);
</script>
</body>
</html>
